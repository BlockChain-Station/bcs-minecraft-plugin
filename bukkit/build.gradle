import org.apache.tools.ant.filters.*

sourceCompatibility = 1.7

version = '3.0.25'

ext {
    bukkit = '1.11-R0.1-SNAPSHOT'
    fanciful = '0.3.5-SNAPSHOT'
}

repositories {
    maven { url 'https://hub.spigotmc.org/nexus/content/groups/public/' }
    maven { url 'http://repo.stealthyone.com/content/groups/public' }
}

dependencies {
    compile project(path: ':common', configuration: 'shadow')
    compile group: 'mkremins', name: 'fanciful', version: fanciful
    compile group: 'org.reflections', name: 'reflections', version: reflections
    compile group: 'javassist', name: 'javassist', version: javassist
    provided project(':core')
    provided project(':rpcapi')
    provided group: 'org.spigotmc', name: 'spigot-api', version: bukkit
    provided fileTree(dir: 'lib', include: '*.jar')
}

jar {
    archiveName = 'EnjinMinecraftPlugin.jar'
}

processResources {
    filter ReplaceTokens, tokens: [
            "version": project.property("version")
    ]
}

shadowJar {
    archiveName = 'EnjinMinecraftPlugin.jar'

    dependencies {
        include(project(':common'))
        include(dependency('.*:fanciful'))
        include(dependency('.*:reflections'))
        include(dependency('.*:javassist'))
        include(dependency('.*:zip4j'))
    }

    exclude('mkremins/fanciful/shaded/**')

    relocate 'mkremins.fanciful.shaded', 'com.enjin.shaded'
    relocate 'mkremins.fanciful', 'com.enjin.shaded.fanciful'
    relocate 'org.reflections', 'com.enjin.shaded.reflections'
    relocate 'javassist', 'com.enjin.shaded.javassist'
    relocate 'net.minidev.json', 'com.enjin.shaded.json'
    relocate 'net.amoebaman', 'com.enjin.shaded.amoebaman'
    relocate 'com.google.gson', 'com.enjin.shaded.gson'
    relocate 'com.thetransactioncompany.jsonrpc2', 'com.enjin.shaded.jsonrpc2'
    relocate 'net.lingala.zip4j', 'com.enjin.shaded.zip4j'
}